import{b as _,a as b,r as k,j as s,L as x,ax as j,av as w,aw as v}from"./index-BIGqcniS.js";import{u as N}from"./useMutation-CFXNc7Zj.js";import{u as S}from"./index.esm-Dk9qpicv.js";const E="_heading_1kg2c_18",y="_label_1kg2c_28",A="_footer_1kg2c_60",e={"sign-in-form":"_sign-in-form_1kg2c_2",heading:E,"fields-group":"_fields-group_1kg2c_23",label:y,"input-field":"_input-field_1kg2c_35","input-field--error":"_input-field--error_1kg2c_46",footer:A,"submit-button":"_submit-button_1kg2c_66","sign-up-group":"_sign-up-group_1kg2c_79","sign-up-link":"_sign-up-link_1kg2c_83"},F=()=>{const{setError:u,clearErrors:a,register:n,handleSubmit:d,watch:t,formState:{errors:i}}=S(),l=_(),m=b(),p=N({mutationFn:r=>j(r),onSuccess:r=>{if(!(r!=null&&r.user.token))throw new Error("No token recieved");localStorage.setItem("authToken",r.user.token),l(w(r.user.token)),l(v(r.user)),m("/")},onError:r=>{var c;try{const o=JSON.parse(r.message);(c=o==null?void 0:o.body)!=null&&c.errors&&u("invalidAuth",{type:"manual",message:"Email or password is invalid"}),console.error("Status:",o.status),console.error("Server errors:",o.body.errors)}catch(o){console.error("Unexpected error format:",o)}}}),g=r=>{p.mutate(r)},h=t("email"),f=t("password");return k.useEffect(()=>{i.invalidAuth&&a("invalidAuth")},[h,f,a]),s.jsxs("form",{onSubmit:d(g),className:e["sign-in-form"],children:[s.jsx("h1",{className:e.heading,children:"Sign in"}),s.jsxs("div",{className:e["fields-group"],children:[s.jsxs("label",{className:e.label,children:["Email address",s.jsx("input",{...n("email",{required:"Email is required",pattern:{value:/^[\w.%+-]+@[a-zA-Z\d.-]+\.[a-zA-Z]{2,}$/,message:"Incorrect email"}}),className:`${e["input-field"]} ${i.email?e["input-field--error"]:""}`,type:"email",placeholder:"Email address"}),i.email&&s.jsx("p",{children:i.email.message})]}),s.jsxs("label",{className:e.label,children:["Password",s.jsx("input",{...n("password",{required:"Password is required"}),className:`${e["input-field"]} ${i.password?e["input-field--error"]:""}`,type:"password",placeholder:"Password"}),i.password&&s.jsx("p",{children:i.password.message})]})]}),i.invalidAuth&&s.jsxs("p",{children:[" ",i.invalidAuth.message]}),s.jsxs("footer",{className:e.footer,children:[s.jsx("button",{className:e["submit-button"],type:"submit",children:"Login"}),s.jsxs("span",{className:e["sign-up-group"],children:["Don't have an account?"," ",s.jsx(x,{to:"/sign-up",className:e["sign-up-link"],children:"Sign Up"})]})]})]})};export{F as default};
