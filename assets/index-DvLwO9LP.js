import{b as j,u as n,a as N,r as v,j as r,ay as w,av as $,aw as E}from"./index-BIGqcniS.js";import{u as S}from"./useMutation-CFXNc7Zj.js";import{u as U}from"./index.esm-Dk9qpicv.js";const k="_heading_1cfpy_18",A="_label_1cfpy_28",q="_filled_1cfpy_52",e={"edit-profile-form":"_edit-profile-form_1cfpy_2",heading:k,"fields-group":"_fields-group_1cfpy_23",label:A,"input-field":"_input-field_1cfpy_35","input-field--error":"_input-field--error_1cfpy_46",filled:q,"submit-button":"_submit-button_1cfpy_59"},T=()=>{const u=j(),l=n(s=>s.user.user.username),o=n(s=>s.user.user.email),m=n(s=>s.user.user.image),b=N(),{register:i,handleSubmit:_,setError:c,formState:{errors:a},reset:p}=U();v.useEffect(()=>{l&&o&&p({username:l,email:o,image:m})},[l,o,m,p]);const y=S({mutationFn:s=>w(s),onSuccess:s=>{console.log("You updated your profile successfully!",s),localStorage.setItem("authToken",s.user.token),u($(s.user.token)),u(E(s.user)),b("/")},onError:s=>{var d,f,g,h;try{const t=JSON.parse(s.message);(f=(d=t==null?void 0:t.body)==null?void 0:d.errors)!=null&&f.username&&c("username",{type:"manual",message:"Username is already taken"}),(h=(g=t==null?void 0:t.body)==null?void 0:g.errors)!=null&&h.email&&c("email",{type:"manual",message:"Email is already taken"}),console.error("Status:",t.status),console.error("Server errors:",t.body.errors)}catch(t){console.error("Unexpected error format:",t)}}}),x=s=>{y.mutate(s)};return r.jsxs("form",{onSubmit:_(x),className:e["edit-profile-form"],children:[r.jsx("h1",{className:e.heading,children:"Edit Profile"}),r.jsxs("div",{className:e["fields-group"],children:[r.jsxs("label",{className:e.label,children:["Username",r.jsx("input",{...i("username",{required:"Username is required"}),className:`${e["input-field"]} ${e.filled} ${a.username?e["input-field--error"]:""}`}),a.username&&r.jsx("p",{children:a.username.message})]}),r.jsxs("label",{className:e.label,children:["Email address",r.jsx("input",{...i("email",{required:"Email is required",pattern:{value:/^[\w.%+-]+@[a-zA-Z\d.-]+\.[a-zA-Z]{2,}$/,message:"Incorrect email"}}),className:`${e["input-field"]} ${e.filled} ${a.email?e["input-field--error"]:""}`,type:"email"}),a.email&&r.jsx("p",{children:a.email.message})]}),r.jsxs("label",{className:e.label,children:["New password",r.jsx("input",{...i("password",{minLength:{value:6,message:"Your password must contain at least 6 characters"},maxLength:{value:40,message:"Your password cannot be longer than 40 characters"}}),className:`${e["input-field"]} ${a.password?e["input-field--error"]:""}`,type:"password",placeholder:"New password"}),a.password&&r.jsx("p",{children:a.password.message})]}),r.jsxs("label",{className:e.label,children:["Avatar image (url)",r.jsx("input",{...i("image",{pattern:{value:/^(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp|svg))$/i,message:"Please enter a valid URL of image"}}),className:`${e["input-field"]} ${a.image?e["input-field--error"]:""}`,placeholder:"Avatar image"}),a.image&&r.jsx("p",{children:a.image.message})]})]}),r.jsx("button",{className:e["submit-button"],type:"submit",children:"Save"})]})};export{T as default};
